<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script th:src="@{/js/vue.js}"></script>
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}">
    <script th:src="@{/js/vue-resource.js}"></script>
    <script th:src="@{/js/jquery-2.1.1.js}"></script>
    <script th:src="@{/js/bootstrap.js}"></script>
    <title>新路网匿名</title>
</head>
<body>
<div class="container-fluid" id="app" style="margin-top: 12px;">
    <div class="row text-left">
        <div class="col-md-7">
            <canvas id="network" width="1000" height="1000" style="border:1px solid #000000;"
                    @click="showInfo($event)">
            </canvas>
        </div>
        <div class="col-md-5">
            <div class="row" style="margin-top: 12px;">
                <div class="col-md-12">
                    <div>
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#opt" aria-controls="opt" role="tab"
                                                                      data-toggle="tab">操作面板</a></li>
                            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab"
                                                       data-toggle="tab">日志面板</a></li>
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="opt">
                                <hr>
                                <button @click="loadRoad()" class="btn btn-primary btn-sm">加载路网数据</button>
                                <button @click="getBFS()" class="btn btn-primary btn-sm">广度优先</button>
                                <button @click="getDFS()" class="btn btn-primary btn-sm">深度优先</button>
                                <button @click="formatData()" class="btn btn-primary btn-sm">格式化数据</button>
                                <button @click="showTable=!showTable" class="btn btn-primary btn-sm">隐藏/显示表格</button>
                                <button @click="draw()" class="btn btn-primary btn-sm">绘制图形</button>
                                <hr>
                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">网络规格</label>
                                        <div class="col-sm-10">
                                            <input type="number" class="form-control"  v-model="width">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">网络大小</label>
                                        <div class="col-sm-10">
                                            <input type="number" class="form-control"  v-model="cellSize">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">K值</label>
                                        <div class="col-sm-10">
                                            <input type="number" class="form-control"  v-model="k">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">网格选取阈值</label>
                                        <div class="col-sm-10">
                                            <input type="number" class="form-control"  v-model="threshold">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">随机点个数</label>
                                        <div class="col-sm-10">
                                            <input type="number" class="form-control"  v-model="randomNum">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button @click="change" class="btn btn-default">更改</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="profile">
                                <hr>
                                <div style="border: 1px  #000000; width: 90%; margin: 0 auto;height: 500px;overflow-y:scroll; overflow-x:scroll;">
                                    <ul>
                                        <li v-for="log in logs">
                                            <span class="text-danger">{{log.time}}: </span> <span class="text-primary">{{log.info}}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * App组件
     */
    const app = new Vue({
        data: {
            canvas: null,
            network: null,
            logs: [],
            // 网格配置相关
            cellSize: 10,
            width: 100,
            k:3,
            threshold: 5,
            randomNum: 10000
        },
        methods: {
            /**
             * 加载路网数据
             */
            loadRoad: function () {
                this.$http.get("[[@{/network/loadData}]]")
                    .then(function (response) {
                        const edges = response.body.edges;
                        const cells = response.body.cells;
                        this.network.lineWidth = this.cellSize;
                        // 先绘制网格
                        for (let i = 0; i < this.width; i++) {
                            for (let j = 0; j < this.width; j++) {
                                this.network.fillStyle = cells[i][j].color;
                                this.network.fillRect(this.cellSize * i, this.cellSize * j, this.cellSize * (i + 1), this.cellSize * (j + 1));
                            }
                        }

                        // 然后绘制路况
                        for (let i = 0; i < edges.length; i++) {
                            const edge = edges[i];
                            this.network.moveTo(edge.v1.x * this.cellSize, edge.v1.y * this.cellSize);
                            this.network.lineTo(edge.v2.x * this.cellSize, edge.v2.y * this.cellSize);
                            this.network.strokeStyle = "#0033CC"
                            this.network.stroke();
                        }
                    })
            },
            showInfo: function (e) {
                const location = this.getLocation(e.clientX, e.clientY);
                this.logInfo("当前位置：x=" + Math.floor(location.x) + " ,y=" + Math.floor(location.y));
            },
            // 获取位置信息
            getLocation: function (x, y) {
                const bbox = this.canvas.getBoundingClientRect();
                return {
                    x: (x - bbox.left) * (this.canvas.width / bbox.width),
                    y: (y - bbox.top) * (this.canvas.height / bbox.height)
                };
            },
            // 记录日志
            logInfo: function(info){
                this.logs.push({
                    info: info,
                    time: this.getNowTime()
                })
            },
            // 获取格式化时间
            getNowTime: function () {
                const date = new Date();
                return this.add0(date.getHours()) + ':' + this.add0(date.getMinutes()) + ':' + this.add0(date.getSeconds());
             },
            change: function(){

            },
            add0: function (s) {
                return s < 10 ? '0' + s: s;
            }
        },
        mounted: function () {
            this.canvas = document.getElementById("network");
            this.network = document.getElementById("network").getContext("2d");
        }
    }).$mount("#app");

</script>
</body>

</html>